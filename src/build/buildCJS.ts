import { build as esbuild } from 'esbuild';
import { nodeExternalsPlugin } from 'esbuild-node-externals';

export interface BuildCJSOptions {
  entry: string;
}

/**
 * Build CJS bundle without CSS (which has been generated by buildESM() function)
 */
export function buildCJS({ entry }: BuildCJSOptions) {
  return esbuild({
    entryPoints: [entry],
    outdir: 'dist',
    outbase: 'src',
    outExtension: {
      '.js': '.cjs.js',
    },
    bundle: true,
    format: 'cjs',
    external: ['*.css', '*.less', '*.sass', '*.scss'],
    plugins: [nodeExternalsPlugin()],
  });
}
